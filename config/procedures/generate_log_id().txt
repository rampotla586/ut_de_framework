--GENERATE_LOG_ID

CREATE OR REPLACE PROCEDURE UT_DE_FRAMEWORK.CONFIG.GENERATE_LOG_ID()
RETURNS NUMBER(38,0)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
  -- Log the current sequence value before the update
  INSERT INTO UT_DE_FRAMEWORK.CONFIG.DEBUG_LOG (LOG_MESSAGE)
  SELECT ''Before Update: '' || CAST(CURRENT_VAL AS STRING)
  FROM UT_DE_FRAMEWORK.CONFIG.SEQUENCE_TRACKER
  WHERE SEQ_NAME = ''DATA_INGESTION_LOG_ID_SEQ'';

  -- Update the sequence value
  UPDATE UT_DE_FRAMEWORK.CONFIG.SEQUENCE_TRACKER
  SET CURRENT_VAL = CURRENT_VAL + 1
  WHERE SEQ_NAME = ''DATA_INGESTION_LOG_ID_SEQ'';

  -- Log the updated sequence value after the update
  INSERT INTO UT_DE_FRAMEWORK.CONFIG.DEBUG_LOG (LOG_MESSAGE)
  SELECT ''After Update: '' || CAST(CURRENT_VAL AS STRING)
  FROM UT_DE_FRAMEWORK.CONFIG.SEQUENCE_TRACKER
  WHERE SEQ_NAME = ''DATA_INGESTION_LOG_ID_SEQ'';

  -- Return the updated sequence value
  RETURN (SELECT CURRENT_VAL 
          FROM UT_DE_FRAMEWORK.CONFIG.SEQUENCE_TRACKER
          WHERE SEQ_NAME = ''DATA_INGESTION_LOG_ID_SEQ'');
END;
';