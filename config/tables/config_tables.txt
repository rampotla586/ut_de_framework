--Configuration Tables

CREATE OR REPLACE TABLE UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_HEADER (
	DATA_INGESTION_ID NUMBER(38,0) NOT NULL DEFAULT UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_ID_SEQ.NEXTVAL,
	DATA_INGESTION_NAME VARCHAR(2000),
	SOURCE_PATH VARCHAR(1000),
	DESTINATION_PATH VARCHAR(1000),
	STAGE_NAME VARCHAR(1000),
	FILE_FORMAT_NAME VARCHAR(1000),
	WAREHOUSE_NAME VARCHAR(1000),
	CRON_EXPRESSION VARCHAR(500),
	SCHEDULE_TIMEZONE VARCHAR(500),
	LOAD_TYPE VARCHAR(100),
	UNIQUE_KEY_COLUMNS VARCHAR(2000),
	IS_ACTIVE BOOLEAN DEFAULT TRUE,
	CREATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	UPDATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	PRIMARY KEY (DATA_INGESTION_ID)
);


CREATE OR REPLACE TABLE UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_MAPPING (
	DATA_INGESTION_MAPPING_ID NUMBER(38,0) NOT NULL DEFAULT UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_MAPPING_ID_SEQ.NEXTVAL,
	DATA_INGESTION_ID NUMBER(38,0),
	DESTINATION_COLUMN_ORDER NUMBER(38,0),
	DESTINATION_COLUMN_NAME VARCHAR(1000),
	DESTINATION_COLUMN_DATATYPE VARCHAR(50),
	IS_ACTIVE BOOLEAN DEFAULT TRUE,
	CREATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	UPDATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	PRIMARY KEY (DATA_INGESTION_MAPPING_ID),
FOREIGN KEY (DATA_INGESTION_ID) REFERENCES UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_HEADER(DATA_INGESTION_ID)
);

CREATE OR REPLACE TABLE UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_LOG (
	DATA_INGESTION_LOG_ID NUMBER(38,0) NOT NULL DEFAULT UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_LOG_ID_SEQ.NEXTVAL,
	DATA_INGESTION_ID NUMBER(38,0),
	SOURCE VARCHAR(1000),
	DESTINATION VARCHAR(1000),
	STAGE VARCHAR(1000),
	FILE_FORMAT VARCHAR(1000),
	WAREHOUSE VARCHAR(1000),
	SCHEDULE VARCHAR(1000),
	LOAD_TYPE VARCHAR(100),
	LOAD_START_TIME TIMESTAMP_NTZ(9),
	LOAD_END_TIME TIMESTAMP_NTZ(9),
	SOURCE_COUNT NUMBER(38,0),
	DESTINATION_COUNT NUMBER(38,0),
	LOAD_STATUS VARCHAR(100),
	ERROR_MESSAGE VARCHAR(16777216),
	PRIMARY KEY (DATA_INGESTION_LOG_ID),
	FOREIGN KEY (DATA_INGESTION_ID) REFERENCES UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_HEADER(DATA_INGESTION_ID)
);

CREATE OR REPLACE TABLE UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_SCHEDULE (
	DATA_INGESTION_SCHEDULE_ID NUMBER(38,0) NOT NULL DEFAULT UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_SCHEDULE_ID_SEQ.NEXTVAL,
    DATA_INGESTION_ID NUMBER(38,0) NOT NULL,
	LAST_RUN TIMESTAMP_NTZ(9),
	NEXT_RUN TIMESTAMP_NTZ(9),
	CREATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	UPDATED_AT TIMESTAMP_NTZ(9) DEFAULT CURRENT_TIMESTAMP(),
	PRIMARY KEY (DATA_INGESTION_SCHEDULE_ID),
	FOREIGN KEY (DATA_INGESTION_ID) REFERENCES UT_DE_FRAMEWORK.CONFIG.DATA_INGESTION_HEADER(DATA_INGESTION_ID)
);

create or replace TABLE UT_DE_FRAMEWORK.CONFIG.SEQUENCE_TRACKER (
	SEQ_NAME VARCHAR(16777216) NOT NULL,
	CURRENT_VAL NUMBER(38,0),
	primary key (SEQ_NAME)
);


create or replace TABLE UT_DE_FRAMEWORK.CONFIG.PROCESS_LOG (
	PROCESS_NAME VARCHAR(16777216),
	STATUS VARCHAR(16777216),
	DATA_INGESTION_ID NUMBER(38,0),
	MESSAGE VARCHAR(16777216),
	CREATED_AT TIMESTAMP_NTZ(9)
);